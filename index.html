<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Performance, Forms, Commitments</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary-bg: #f9f9f9;
      --primary-accent: #d32f2f;
      --primary-border: #d1d5db;
      --primary-radius: 8px;
      --primary-font: 'Segoe UI', Arial, sans-serif;
      --target-highlight: #fff59d;
      --target-entry-color: #d32f2f;
      --leaderboard-bg: #DC008C;
      --leaderboard-color: #111;
      --metric-grey: #ededed;
      --store-black: #111;
      --store-white: #fff;
      --white: #fff;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--primary-bg);
      font-family: var(--primary-font);
      color: #222;
      min-height: 100vh;
      box-sizing: border-box;
    }
    body {
      max-width: 570px;
      margin: 0 auto;
      padding: 1em 0.5em 3em 0.5em;
      box-sizing: border-box;
    }
    h1 {
      font-size: 1.3em;
      margin-bottom: 1em;
      text-align: center;
      color: var(--primary-accent);
      letter-spacing: 1px;
      font-weight: 700;
    }
    .section-title {
      font-size: 1.2em;
      font-weight: 700;
      text-align: center;
      margin: 0.6em 0 1.1em 0;
      background: var(--leaderboard-bg);
      color: var(--leaderboard-color);
      border-radius: var(--primary-radius);
      padding: 0.6em;
      letter-spacing: 1px;
    }
    .hidden { display: none !important; }
    form {
      background: #fff;
      padding: 1em 0.7em 1em 0.7em;
      border-radius: var(--primary-radius);
      box-shadow: 0 2px 8px 0 #0001;
      margin-bottom: 1em;
    }
    label {
      display: block;
      margin-top: 0.7em;
      font-weight: 500;
      font-size: 1em;
    }
    select, input[type="text"], button {
      font-size: 1em;
      width: 100%;
      padding: 0.6em;
      border: 1px solid var(--primary-border);
      border-radius: var(--primary-radius);
      box-sizing: border-box;
      margin-top: 0.4em;
      margin-bottom: 0.4em;
      background: #fcfcfc;
      transition: box-shadow 0.2s, border 0.2s;
    }
    select:focus, input[type="text"]:focus, .target-input:focus {
      outline: none;
      border: 1.5px solid var(--primary-accent);
      box-shadow: 0 0 3px 1.5px #d32f2f40;
    }
    button {
      background: var(--primary-accent);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      margin-top: 1em;
      margin-bottom: 0;
      border: none;
      transition: background 0.2s;
      font-size: 1em;
      border-radius: var(--primary-radius);
    }
    button:hover, button:focus {
      background: #a62828;
    }
    .actions {
      display: flex;
      gap: 0.5em;
      margin-top: 1em;
      flex-wrap: wrap;
    }
    .actions > button {
      flex: 1;
      min-width: 90px;
      font-size: 0.98em;
    }
    .metric-row {
      margin-bottom: 1em;
    }
    .metric-label {
      font-weight: 600;
      font-size: 1em;
      margin-bottom: 0.2em;
      display: block;
    }
    .entry-row {
      display: flex;
      gap: 0.6em;
      margin-top: 0.1em;
    }
    .entry-col {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .entry-label {
      font-size: 0.97em;
      margin-bottom: 0.08em;
      font-weight: 400;
      color: #777;
    }
    .target-input {
      font-size: 1em;
      padding: 0.45em;
      border: 1.5px solid var(--primary-accent);
      border-radius: var(--primary-radius);
      background: #f3f3f3;
      color: var(--target-entry-color);
      font-weight: 500;
      box-sizing: border-box;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .current-input {
      font-size: 1em;
      padding: 0.45em;
      border: 1px solid var(--primary-border);
      border-radius: var(--primary-radius);
      background: #fcfcfc;
      color: #222;
      font-weight: 500;
      box-sizing: border-box;
      transition: border 0.2s, box-shadow 0.2s;
    }
    .reset-targets-btn {
      margin-top: 1.1em;
      margin-bottom: 0.3em;
      background: #757575;
      color: #fff;
      border: none;
      border-radius: var(--primary-radius);
      padding: 0.6em 1em;
      font-size: 0.97em;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
      display: block;
    }
    .reset-targets-btn:hover, .reset-targets-btn:focus {
      background: #a62828;
    }
    #tableTitle {
      text-align: center;
      font-weight: 600;
      font-size: 1.1em;
      margin: 0.8em 0 0.2em 0;
      color: var(--primary-accent);
      letter-spacing: 0.6px;
    }
    #printMeta {
      text-align: center;
      margin-bottom: 8px;
      color: #444;
      font-size: 0.97em;
      word-break: break-word;
    }
    .table-page {
      display: block;
      background: var(--white);
      border-radius: var(--primary-radius);
      box-shadow: 0 2px 8px 0 #0001;
      padding: 1em 0.2em;
      margin-top: 2em;
      margin-bottom: 2em;
    }
    .table-container {
      width: 100%;
      overflow-x: auto;
      margin: 0 auto;
      background: #fff;
      border-radius: var(--primary-radius);
      box-shadow: none;
      padding: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      font-size: 0.97em;
      min-width: 530px;
    }
    th, td {
      border: 1px solid var(--primary-border);
      padding: 0.45em 0.1em;
      text-align: center;
      vertical-align: middle;
      word-break: break-word;
    }
    th {
      background: #ffebee;
      color: var(--primary-accent);
      font-size: 1em;
      font-weight: 700;
    }
    .metric-cell, .pre-cs-row td {
      background: var(--metric-grey) !important;
      color: #222 !important;
      font-weight: 600;
    }
    .store-cell {
      background: var(--store-black) !important;
      color: var(--store-white) !important;
      font-weight: 700 !important;
      letter-spacing: 0.7px;
      font-size: 1em;
      white-space: nowrap;
    }
    .target-cell {
      background: var(--target-highlight) !important;
      font-weight: 700;
      color: var(--primary-accent) !important;
    }
    .leaderboard-row td {
      background: var(--leaderboard-bg) !important;
      color: var(--leaderboard-color) !important;
      font-weight: 700;
      font-size: 1.03em;
      letter-spacing: 1.5px;
      text-align: center;
      border: none !important;
      padding: 0.8em 0 !important;
    }
    .top-title-row td {
      background: var(--leaderboard-bg) !important;
      color: var(--leaderboard-color) !important;
      font-weight: bold !important;
      font-size: 2em !important;
      letter-spacing: 1.5px;
      text-align: center;
      border: none !important;
      padding: 1em 0 !important;
      border-radius: var(--primary-radius) var(--primary-radius) 0 0;
    }
    .pre-cs-row td {
      background: var(--white) !important;
      color: #222 !important;
      border: none !important;
      font-size: 1em;
      padding: 0.6em 0 !important;
    }
    /* Individual column widths applied with JS */
    @media (max-width: 700px) {
      body {
        padding: 0.2em 0.05em 2em 0.05em;
      }
      .entry-row {
        flex-direction: column;
        gap: 0.3em;
      }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      table {
        font-size: 1em;
        min-width: 0;
      }
      thead {
        display: none;
      }
      tr {
        margin-bottom: 1em;
        background: #fff;
        box-shadow: 0 1px 4px 0 #0001;
        border-radius: var(--primary-radius);
      }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 45%;
        text-align: left;
        min-height: 30px;
      }
      td:before {
        position: absolute;
        top: 0;
        left: 0;
        width: 44%;
        padding-left: 0.5em;
        font-weight: 600;
        white-space: pre-wrap;
        color: #555;
      }
      tr td:first-child {
        background: var(--metric-grey) !important;
        border-radius: var(--primary-radius) var(--primary-radius) 0 0;
        font-weight: 700;
        padding-left: 1em;
        color: #222 !important;
        font-size: 1em;
      }
      .leaderboard-row td {
        padding-left: 0 !important;
        text-align: center !important;
        font-size: 1em !important;
      }
      .store-cell {
        background: var(--store-black) !important;
        color: var(--store-white) !important;
      }
    }
    @media (max-width: 430px) {
      form, table {
        border-radius: 0;
        box-shadow: none;
      }
      .actions > button {
        font-size: 0.93em;
        min-width: 0;
      }
      #tableTitle {
        font-size: 0.97em;
      }
    }
    @media print {
      body {
        background: #fff;
        color: #000;
        max-width: none;
        padding: 0;
      }
      h1, #metricsSection, #gapsSection, #formsSection, .actions, .form-metrics, .form-gaps, .form-forms, #backToMetrics, #clearAllData, #printTableBtn, #selectionSection, #metricsForm, #gapsForm, #formsForm, button, .actions, .hidden, .reset-targets-btn {
        display: none !important;
      }
      #tableSection, #tableTitle, #printMeta, .table-container, table, thead, tbody, tr, th, td {
        display: block !important;
        color: #000;
      }
      #tableSection {
        margin: 0;
        padding: 0;
      }
      #tableTitle, #printMeta {
        margin-top: 0;
        margin-bottom: 4px;
        font-size: 1.1em;
        color: #000 !important;
      }
      table {
        font-size: 0.92em;
        margin-top: 0.2em;
        border-radius: 0;
        box-shadow: none;
        width: 100%;
      }
      th, td {
        color: #000 !important;
        border: 1px solid #999 !important;
        background: #fff !important;
        padding: 0.3em 0.06em;
      }
      th {
        color: #000 !important;
        background: #eee !important;
      }
      .leaderboard-row td {
        background: #DC008C !important;
        color: #111 !important;
        border: none !important;
        font-weight: 700 !important;
        font-size: 1.03em !important;
        letter-spacing: 1.5px !important;
        text-align: center !important;
        padding: 0.7em 0 !important;
      }
      .metric-cell, .pre-cs-row td {
        background: #ededed !important;
        color: #222 !important;
        font-weight: 600 !important;
      }
      .store-cell {
        background: #111 !important;
        color: #fff !important;
        font-weight: 700 !important;
        letter-spacing: 0.7px !important;
      }
      .top-title-row td {
        background: #DC008C !important;
        color: #111 !important;
        font-weight: bold !important;
        font-size: 2em !important;
      }
      @page {
        size: portrait;
        margin: 0.45in 0.18in 0.45in 0.18in;
      }
    }
  </style>
  <script src="hierarchy.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // Set individual column widths
    function setTableColumnWidths() {
      const table = document.getElementById('mainMetricsTable');
      if (!table) return;
      const colWidths = [
        'auto',   // Store/Metric column
        '110px',  // Target
        '110px',  // Week 1
        '110px',  // Week 2
        '110px',  // Week 3
        '110px',  // Week 4
        '110px'   // Week 5
      ];
      let colgroup = table.querySelector('colgroup');
      if (colgroup) table.removeChild(colgroup);
      colgroup = document.createElement('colgroup');
      for (let i = 0; i < colWidths.length; i++) {
        const col = document.createElement('col');
        col.style.width = colWidths[i];
        colgroup.appendChild(col);
      }
      table.insertBefore(colgroup, table.firstChild);
    }
    window.onload = setTableColumnWidths;
    window.addEventListener('resize', setTableColumnWidths);
  </script>
  <!-- ... rest of the code is unchanged ... -->
</head>
<body>
  <h1>Weekly Business Review</h1>
  <!-- Selection Page -->
  <div id="selectionSection">
    <form id="selectionForm" autocomplete="off">
      <label>Area:
        <select id="areaDropdown" required>
          <option value="">--Select Area--</option>
        </select>
      </label>
      <label>Region:
        <select id="regionDropdown" required disabled>
          <option value="">--Select Region--</option>
        </select>
      </label>
      <label>District:
        <select id="districtDropdown" required disabled>
          <option value="">--Select District--</option>
        </select>
      </label>
      <label>Store:
        <select id="storeDropdown" required disabled>
          <option value="">--Select Store--</option>
        </select>
      </label>
      <label>Select Week: 
        <select id="weekSelect" required>
          <option value="">--Select Week--</option>
          <option value="1">Week 1</option>
          <option value="2">Week 2</option>
          <option value="3">Week 3</option>
          <option value="4">Week 4</option>
          <option value="5">Week 5</option>
        </select>
      </label>
      <div class="actions">
        <button type="submit" id="nextToMetrics">Next</button>
      </div>
    </form>
  </div>

  <!-- CS Leaderboard Data Entry Page -->
  <div id="metricsSection" class="hidden">
    <div class="section-title">CS Leaderboard</div>
    <form id="metricsForm" autocomplete="off">
      <div class="form-metrics"></div>
      <button type="button" class="reset-targets-btn" id="resetTargetsBtn">Reset Targets to Default</button>
      <div class="actions">
        <button type="button" id="backButton">Back</button>
        <button type="button" id="nextToGapsBtn">Next</button>
      </div>
    </form>
  </div>

  <!-- Current Gaps Data Entry Page -->
  <div id="gapsSection" class="hidden">
    <div class="section-title">Current Gaps</div>
    <form id="gapsForm" autocomplete="off">
      <div class="form-gaps"></div>
      <button type="button" class="reset-targets-btn" id="resetGapsTargetsBtn">Reset Targets to Default</button>
      <div class="actions">
        <button type="button" id="backToLeaderboardBtn">Back</button>
        <button type="button" id="nextToFormsBtn">Next</button>
      </div>
    </form>
  </div>

  <!-- Form Usage Data Entry Page -->
  <div id="formsSection" class="hidden">
    <div class="section-title">Form Usage (previous week)</div>
    <form id="formsForm" autocomplete="off">
      <div class="form-forms"></div>
      <button type="button" class="reset-targets-btn" id="resetFormsTargetsBtn">Reset Targets to Default</button>
      <div class="actions">
        <button type="button" id="backToGapsBtn">Back</button>
        <button type="submit" id="nextBtnForms">Next</button>
      </div>
    </form>
  </div>

  <!-- Data Table Page -->
  <div id="tableSection" class="table-page hidden">
    <div id="printMeta"></div>
    <h2 id="tableTitle"></h2>
    <div class="table-container" id="tableWrapper">
      <table id="mainMetricsTable">
        <thead>
          <tr class="top-title-row">
            <td colspan="7">Performance & Forms</td>
          </tr>
          <tr class="pre-cs-row">
            <td colspan="7"></td>
          </tr>
          <tr class="header-row" id="metricsHeaderRow"></tr>
          <tr class="leaderboard-row" id="leaderboardRow"></tr>
        </thead>
        <tbody id="metricsTable"></tbody>
        <tbody id="gapsTable"></tbody>
        <tbody id="formsTable"></tbody>
      </table>
    </div>
    <div class="actions" id="tableActions">
      <button id="backToMetrics">Back</button>
      <button id="clearAllData">Clear All Data</button>
      <button id="printTableBtn" type="button">Print</button>
    </div>
  </div>
  <!-- The JS logic for form handling, rendering, etc. should follow as in previous code blocks. -->
</body>
</html>
